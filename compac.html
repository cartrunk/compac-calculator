<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Bin & Case Calculator</title>
  <style>
    body {
      background-color: black;
      color: green;
      font-family: 'Calibri', sans-serif;
      margin: 0;
      padding: 1rem;
    }
    label {
      display: inline-block;
      width: 200px;
      margin-bottom: 0.5rem;
    }
    input, select {
      width: 100px;
      margin-bottom: 0.5rem;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
    }
    .divider {
      margin: 1rem 0;
      border-top: 1px solid white;
    }
    .button {
      background-color: dodgerblue;
      color: white;
      font-size: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 10px;
    }
    .button:hover {
      background-color: #1d86d9;
    }
    h1 {
      text-align: center;
    }
    .output {
      color: green;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bin & Case Calculator</h1>

    <!-- Input Fields -->
    <div>
      <label for="line">Pack line:</label>
      <select id="line" onchange="toggleAcc4()">
        <option value="">--</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
      </select>
    </div>

    <div>
      <label for="bagwt">Bag weight:</label>
      <select id="bagwt">
        <option value="">--</option>
        <option value="1">1 lb</option>
        <option value="2">2 lb</option>
        <option value="3">3 lb</option>
        <option value="5">5 lb</option>
      </select>
    </div>

    <div>
      <label for="tcn">Total cases needed:</label>
      <input type="number" id="tcn" />
    </div>

    <div>
      <label for="tbd">Total bins dumped:</label>
      <input type="number" id="tbd" />
    </div>

    <div>
      <label for="tbw">Total bin weight:</label>
      <input type="number" id="tbw" />
    </div>

    <div>
      <label for="tcm">Total cases made:</label>
      <input type="number" id="tcm" />
    </div>

    <div>
      <label for="sizer">Sizer fullness %:</label>
      <input type="number" id="sizer" />
    </div>

    <div>
      <label for="acc1">Accumulator 1:</label>
      <input type="number" id="acc1" />
    </div>

    <div>
      <label for="acc2">Accumulator 2:</label>
      <input type="number" id="acc2" />
    </div>

    <div>
      <label for="acc3">Accumulator 3:</label>
      <input type="number" id="acc3" />
    </div>

    <div id="acc4row">
      <label for="acc4">Accumulator 4:</label>
      <input type="number" id="acc4" />
    </div>

    <div class="divider"></div>

    <!-- Output Fields -->
    <div>
      <label>Bins to ask for:</label>
      <span class="output" id="bins">*</span>
    </div>

    <div>
      <label>Pallets left:</label>
      <span class="output" id="palletsLeft">*</span>
    </div>

    <div>
      <label>Cases left:</label>
      <span class="output" id="casesLeft">*</span>
    </div>

    <div>
      <label>Cases on line:</label>
      <span class="output" id="casesOnLine">*</span>
    </div>

    <div>
      <label>Average bin weight:</label>
      <span class="output" id="avgBinWeight">*</span>
    </div>

    <div>
      <label>Line utilization:</label>
      <span class="output" id="lineUtil">*</span>
    </div>

    <!-- Buttons -->
    <div style="margin-top: 1rem;">
      <button class="button" onclick="calculate()">Calculate</button>
      <button class="button" style="background-color:red;" onclick="resetFields()">Reset</button>
    </div>
  </div>

  <script>
    // Hide/show accumulator 4 based on line selection
    function toggleAcc4() {
      var lineVal = parseInt(document.getElementById('line').value);
      var acc4row = document.getElementById('acc4row');
      if (lineVal === 1 || lineVal === 4) {
        acc4row.style.display = 'none';
        document.getElementById('acc4').value = '';
      } else {
        acc4row.style.display = '';
      }
    }

    // Bag weight lookup tables
    var bagpMap = { 1: 87, 2: 48, 3: 32, 5: 17 };       // bags per % line fullness
    var bagsPerCase = { 1: 30, 2: 15, 3: 10, 5: 6 };     // 30 lbs / bag weight

    function calculate() {
      try {
        var lineVal = parseInt(document.getElementById('line').value);
        var bagWt   = parseInt(document.getElementById('bagwt').value);
        var i3  = parseInt(document.getElementById('tcn').value);
        var i4  = parseInt(document.getElementById('tbd').value);
        var i5  = parseInt(document.getElementById('tbw').value);
        var i6  = parseInt(document.getElementById('tcm').value);
        var i7  = parseInt(document.getElementById('sizer').value);
        var i8  = parseInt(document.getElementById('acc1').value);
        var i9  = parseInt(document.getElementById('acc2').value);
        var i10 = parseInt(document.getElementById('acc3').value);

        var required = [lineVal, bagWt, i3, i4, i5, i6, i7, i8, i9, i10];

        // Lines with 4 accumulators need acc4
        var i11 = 0;
        if (lineVal !== 1 && lineVal !== 4) {
          i11 = parseInt(document.getElementById('acc4').value);
          required.push(i11);
        }

        if (required.some(isNaN)) {
          throw new Error('Please enter valid values in all fields.');
        }

        var bpc  = bagsPerCase[bagWt]; // bags per case (30/bagWt)
        var bagp = bagpMap[bagWt];     // bags per % line fullness

        // Calculate accumulator average
        var tfull = 0;
        if (lineVal === 1 || lineVal === 4) {
          tfull = (i8 + i9 + i10) / 3;
        } else {
          tfull = (i8 + i9 + i10 + i11) / 4;
        }

        var bndd   = bpc * i3;                  // bags needed
        var abw    = Math.floor(i5 / i4);       // average bin weight
        var tlp    = tfull + i7;                 // total line percentage
        var tbol   = tlp * bagp;                 // total bags on line
        var tbol_c = Math.floor(tbol / bpc);     // total cases on line
        var bpkd   = i6 * bpc;                  // bags packed
        var bpro   = tbol + bpkd;               // bags on line + bags packed
        var bleft  = bndd - bpro;               // bags left
        var wndd   = bleft * (bagWt + 0.25);    // weight needed
        var bnleft = Math.floor(wndd / abw);    // bins left to dump
        var binsAsk = bnleft + i4;              // bins total to ask for
        var cleft  = i3 - i6;                   // cases left
        var caseW  = bpc * bagWt;               // weight of one case
        var wmade  = (i6 + tbol_c) * caseW;     // weight packed + weight on line

        // utilization ratio
        var uti = 0;
        if (i5 !== 0) {
          uti = wmade / i5;
        }
        var uti2 = Math.floor(uti * 100);

        // pallets left â€” line 4 uses 90 cases/pallet, others use 60
        var pleft = 0;
        if (lineVal === 4) {
          pleft = Math.floor(cleft / 90);
        } else {
          pleft = Math.floor(cleft / 60);
        }

        // Update output fields
        document.getElementById('bins').textContent = binsAsk;
        document.getElementById('palletsLeft').textContent = pleft;
        document.getElementById('casesLeft').textContent = cleft;
        document.getElementById('casesOnLine').textContent = tbol_c;
        document.getElementById('avgBinWeight').textContent = abw;
        document.getElementById('lineUtil').textContent = uti2 + '%';

      } catch (err) {
        alert(err.message);
      }
    }

    function resetFields() {
      // Clear input fields
      document.getElementById('line').value = '';
      document.getElementById('bagwt').value = '';
      document.getElementById('tcn').value = '';
      document.getElementById('tbd').value = '';
      document.getElementById('tbw').value = '';
      document.getElementById('tcm').value = '';
      document.getElementById('sizer').value = '';
      document.getElementById('acc1').value = '';
      document.getElementById('acc2').value = '';
      document.getElementById('acc3').value = '';
      document.getElementById('acc4').value = '';
      document.getElementById('acc4row').style.display = '';

      // Reset output fields
      document.getElementById('bins').textContent = '*';
      document.getElementById('palletsLeft').textContent = '*';
      document.getElementById('casesLeft').textContent = '*';
      document.getElementById('casesOnLine').textContent = '*';
      document.getElementById('avgBinWeight').textContent = '*';
      document.getElementById('lineUtil').textContent = '*';
    }
  </script>
</body>
</html>
